
---
```sh
[root@vm1 iris]# docker build -t iris:1.0 .
[root@vm1 iris]# docker run -itd --name iris -p 5000:5000 iris:1.0
```
## 與 GitLab 建立 SSH 連線
GitLab setting
SSH Keys
centos7-2
```sh
[root@vm2 user]# cd ~
[root@vm2 ~]# cd .ssh

[root@vm2 .ssh]# ls
authorized_keys  id_rsa  id_rsa.pub

ssh-keygen
>Enter
>Enter
>Enter
[root@vm1 iris]# git commit -m "Initial commit"
[root@vm1 iris]# git push -u origin master

```
## gitlab-runner
```sh
[root@vm2 ~]# curl -L --output /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 35.3M  100 35.3M    0     0  1820k      0  0:00:19  0:00:19 --:--:-- 2395k
[root@vm2 ~]# chmod +x /usr/local/bin/gitlab-runner
[root@vm2 ~]# useradd --comment 'GitLab Runner' --create-home gitlab-runner --shell /bin/bash
[root@vm2 ~]# usermod -aG docker gitlab-runner
[root@vm2 ~]# su - user
Last login: Tue Oct 27 14:51:16 CST 2020 from 192.168.56.1 on pts/1
[user@vm2 ~]$ docker ps
Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.40/containers/json: dial unix /var/run/docker.sock: connect: permission denied
[user@vm2 ~]$ su - gitlab-runner
Password:
su: Authentication failure
[user@vm2 ~]$ exit
logout
[root@vm2 ~]# su - gitlab-runner
Last failed login: Tue Oct 27 15:40:35 CST 2020 on pts/1
There was 1 failed login attempt since the last successful login.
[gitlab-runner@vm2 ~]$ docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES


[root@vm2 ~]# /usr/local/bin/gitlab-runner install --user=gitlab-runner --working-directory=/home/gitlab-runner
Runtime platform                                    arch=amd64 os=linux pid=3812 revision=ece86343 version=13.5.0
[root@vm2 ~]# /usr/local/bin/gitlab-runner start
Runtime platform                                    arch=amd64 os=linux pid=3862 revision=ece86343 version=13.5.0

```
```sh
[root@vm2 ~]# gitlab-runner register
Runtime platform                                    arch=amd64 os=linux pid=4040 revision=ece86343 version=13.5.0
Running in system-mode.

Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):
https://gitlab.com/
Please enter the gitlab-ci token for this runner:
Myzxuf3bckJvMRf3DLVJ
Please enter the gitlab-ci description for this runner:
[vm2]: centos7-2-local-runner
Please enter the gitlab-ci tags for this runner (comma separated):
centos7-2
Registering runner... succeeded                     runner=Myzxuf3b
Please enter the executor: ssh, virtualbox, docker+machine, docker-ssh+machine, kubernetes, docker, docker-ssh, shell, custom, parallels:
shell
Runner registered successfully. Feel free to start it, but if it's running already the config should be automatically reloaded!
[root@vm2 ~]#

```
**R1**
```sh
[root@vm1 iris]# vim .gitlab-ci.yml
[root@vm1 iris]# ls -a
.   client.py   .git            model.pkl         server.py
..  Dockerfile  .gitlab-ci.yml  requirements.txt  train_model.py
[root@vm1 iris]# git add .gitlab-ci.yml
[root@vm1 iris]# git commit -m "submit .gitlab-ci.yml"
[master 79f10ad] submit .gitlab-ci.yml
 1 file changed, 11 insertions(+)
 create mode 100644 .gitlab-ci.yml
[root@vm1 iris]# git push -u origin master
Counting objects: 4, done.
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 432 bytes | 0 bytes/s, done.
Total 3 (delta 1), reused 0 (delta 0)
To git@gitlab.com:linjiachi/myiris.git
   8269bf6..79f10ad  master -> master
Branch master set up to track remote branch master from origin.

```

---
參考資料：
- [吳良超的學習筆記 - 通过 Flask, Docker, Jenkins 和 Kubernets 部署机器学习模型](http://wulc.me/2019/04/19/%E9%80%9A%E8%BF%87%20Flask,%20Docker,%20Jenkins%20%E5%92%8C%20Kubernets%20%E9%83%A8%E7%BD%B2%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%A8%A1%E5%9E%8B/)
- [Install GitLab Runner manually on GNU/Linux](https://docs.gitlab.com/runner/install/linux-manually.html)
- []()